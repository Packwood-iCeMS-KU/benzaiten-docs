<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><link href="https://icems-research-computing.github.io/benzaiten-docs/new_mod/" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>New Module System - Benzaiten Cluster Documentation</title>
<link href="../css/theme.css" rel="stylesheet"/>
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet"/>
<link href="../extra.css" rel="stylesheet"/>
<link href="../css/neoteroi-mkdocs.css" rel="stylesheet"/>
<script>
        // Current page data
        var mkdocs_page_name = "New Module System";
        var mkdocs_page_input_path = "new_mod.md";
        var mkdocs_page_url = "/benzaiten-docs/new_mod/";
      </script>
<!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> Benzaiten Cluster Documentation
        </a><div role="search">
<form action="../search.html" class="wy-form" id="rtd-search-form" method="get">
<input aria-label="Search docs" name="q" placeholder="Search docs" title="Type search term here" type="text"/>
</form>
</div>
</div>
<div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../accessing_the_cluster/">Accessing the Cluster</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basic_commands/">Basic Commands</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../storage/">Storage and Quotas</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../partitions/">Using Partitions</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../running_jobs/">Running Jobs</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../parallel_processing/">Parallel Processing</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../managing_jobs/">Managing Jobs</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../solar_vuw/">Connecting to High Capacity Storage</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cloud_providers/">Connecting to Cloud Providers</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../containers/">Using Containers</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/">Using Jupyter Notebooks</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/">Examples</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usersub/">User Submitted Docs</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../hpclayout/">HPC Hardware Layout</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../support/">Support</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="Mobile navigation menu" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">Benzaiten Cluster Documentation</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content"><div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a aria-label="Docs" class="icon icon-home" href=".."></a> »</li>
<li class="breadcrumb-item active">New Module System</li>
<li class="wy-breadcrumbs-aside">
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div class="section" itemprop="articleBody">
<h1 id="new-module-system">New Module System<a class="headerlink" href="#new-module-system" title="Permanent link">¶</a></h1>
<p>In 2020 we started building packages and organising them into modules<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup> in a new way.  In the new system modules are organised into toolchains<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>.  These toolchains were used to build the software. For most users the most important thing is these these toolchains act like software "silos". </p>
<p>In general this restricts you to using using programs in one toolchain "silo".  This is on the face of it, is annoying.  However, it resolves some very hard to diagnose and subtle bugs that occur when you load programs that are built with different compilers - in the old system this was not transparent to you.</p>
<p>Before you module load a toolchain the software contained within will not be visible to module loading (except via module spider).  You first need to load the compiler and MPI version the software was built with. For example, if you wanted to load <code>BioPython/1.79</code> you would first need to load <code>GCC/10.3.0</code> and <code>OpenMPI/4.1.1</code></p>
<p>To save you needing to load both a Compiler and MPI version, the compiler and MPI versions are bundled into half yearly packs.  For example <code>GCC/10.3.0 and OpenMPI/4.1.1</code> are bundled in the meta module <code>foss/2021a</code></p>
<div class="mermaid">graph TD;
    LMOD["Module System"] --toolchain --- foss2020b["foss2020b <br/> GCC/10.2.0 OpenMPI/4.0.5"]
    LMOD --toolchain --- foss2021a["foss2021a <br/> GCC/10.3.0 OpenMPI/4.1.1"]
    foss2020b --- id3["ORCA/4.2.1"]
    foss2020b --- id4["Singularity/3.7.3"]
    foss2021a --- id5["Biopython/1.79"]
    foss2021a --- id6["Haploflow/1.0"]
</div>
<p><br/></p>
<p>Example loading <code>BioPython/1.7.9</code>
<div class="highlight"><pre><span></span><code><span class="c1"># loading the modules</span>
module<span class="w"> </span>load<span class="w"> </span>foss/2021a<span class="w">  </span><span class="c1"># Needed for biopython to be loadable</span>
module<span class="w"> </span>load<span class="w"> </span>BioPython/1.7.9
</code></pre></div></p>
<h2 id="searching-for-software-with-spider">Searching for Software with Spider<a class="headerlink" href="#searching-for-software-with-spider" title="Permanent link">¶</a></h2>
<p>As the software is siloed into toolchains methods for finding software like <code>module avail</code> are less useful than in the old system - it will only show software loadable in the current toolchain silo, or if no toolchain silos are loaded it'll show you all the toolchains as well as software that's not tied to a toolchain.</p>
<p>We can use <code>module spider</code> to search for software modules more broadly - it will also show what toolchain needs to be loaded first.</p>
<p>If we wanted to load a version of netCDF, we could search for it with spider.  Note spider searches in a case sensitive manner - but it will suggest other capitalisation if other search options exist.
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>spider<span class="w"> </span>netCDF
</code></pre></div></p>
<p>This returns a lot of information, but the important bit is:
<div class="highlight"><pre><span></span><code>-------------
<span class="w">  </span>netCDF:
-------------
<span class="w">    </span>Description:
<span class="w">      </span>NetCDF<span class="w"> </span><span class="o">(</span>network<span class="w"> </span>Common<span class="w"> </span>Data<span class="w"> </span>Form<span class="o">)</span><span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">set</span><span class="w"> </span>of<span class="w"> </span>software<span class="w"> </span>libraries
<span class="w">      </span>and<span class="w"> </span>machine-independent<span class="w"> </span>data<span class="w"> </span>formats<span class="w"> </span>that<span class="w"> </span>support
<span class="w">      </span>the<span class="w"> </span>creation,<span class="w"> </span>access,<span class="w"> </span>and<span class="w"> </span>sharing<span class="w"> </span>of<span class="w"> </span>array-oriented<span class="w"> </span>scientific
<span class="w">      </span>data.<span class="w"> </span>

<span class="w">     </span>Versions:
<span class="w">        </span>netCDF/4.7.1
<span class="w">        </span>netCDF/4.7.4
<span class="w">        </span>netCDF/4.8.0

--------------
<span class="w">  </span>For<span class="w"> </span>detailed<span class="w"> </span>information<span class="w"> </span>about<span class="w"> </span>a<span class="w"> </span>specific<span class="w"> </span><span class="s2">"netCDF"</span><span class="w"> </span>module<span class="w"> </span><span class="o">(</span>including
<span class="w">  </span>how<span class="w"> </span>to<span class="w"> </span>load<span class="w"> </span>the<span class="w"> </span>modules<span class="o">)</span><span class="w"> </span>use<span class="w"> </span>the<span class="w"> </span>modules<span class="w"> </span>full<span class="w"> </span>name.
<span class="w">  </span>For<span class="w"> </span>example:

<span class="w">     </span>$<span class="w"> </span>module<span class="w"> </span>spider<span class="w"> </span>netCDF/4.7.1
--------------
</code></pre></div></p>
<p>We have 3 versions of netCDF available in the new module system, <code>4.7.1</code>,<code>4.7.4</code> and <code>4.8.0</code>.  To see which toolchain needs to be loaded, we spider that particular version
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>spider<span class="w"> </span>netCDF/4.7.1

<span class="c1">#returns</span>
----------
<span class="w">  </span>netCDF:<span class="w"> </span>netCDF/4.7.1
----------
<span class="w">    </span>Description:
<span class="w">      </span>NetCDF<span class="w"> </span><span class="o">(</span>network<span class="w"> </span>Common<span class="w"> </span>Data<span class="w"> </span>Form<span class="o">)</span><span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">set</span><span class="w"> </span>of<span class="w"> </span>software<span class="w"> </span>libraries<span class="w"> </span>
<span class="w">      </span>and<span class="w"> </span>machine-independent<span class="w"> </span>data<span class="w"> </span>formats<span class="w"> </span>that<span class="w"> </span>support
<span class="w">      </span>the<span class="w"> </span>creation,<span class="w"> </span>access,<span class="w"> </span>and<span class="w"> </span>sharing<span class="w"> </span>of<span class="w"> </span>array-oriented<span class="w"> </span>scientific
<span class="w">    </span>data.<span class="w"> </span>

<span class="w">    </span>You<span class="w"> </span>will<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>load<span class="w"> </span>all<span class="w"> </span>module<span class="o">(</span>s<span class="o">)</span><span class="w"> </span>on<span class="w"> </span>any<span class="w"> </span>one<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>lines<span class="w"> </span>below<span class="w"> </span>
<span class="w">    </span>before<span class="w"> </span>the<span class="w"> </span><span class="s2">"netCDF/4.7.1"</span><span class="w"> </span>module<span class="w"> </span>is<span class="w"> </span>available<span class="w"> </span>to<span class="w"> </span>load.

<span class="w">      </span>GCC/8.3.0<span class="w">  </span>OpenMPI/3.1.4

<span class="w">    </span>Help:

<span class="w">      </span><span class="nv">Description</span>
<span class="w">      </span><span class="o">===========</span>
<span class="w">      </span>NetCDF<span class="w"> </span><span class="o">(</span>network<span class="w"> </span>Common<span class="w"> </span>Data<span class="w"> </span>Form<span class="o">)</span><span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">set</span><span class="w"> </span>of<span class="w"> </span>software<span class="w"> </span>libraries<span class="w"> </span>
<span class="w">       </span>and<span class="w"> </span>machine-independent<span class="w"> </span>data<span class="w"> </span>formats<span class="w"> </span>that<span class="w"> </span>support<span class="w"> </span>the<span class="w"> </span>creation,
<span class="w">       </span>access,<span class="w"> </span>and<span class="w"> </span>sharing<span class="w"> </span>of<span class="w"> </span>array-oriented<span class="w"> </span>
<span class="w">       </span>scientific<span class="w"> </span>data.


<span class="w">      </span>More<span class="w"> </span><span class="nv">information</span>
<span class="w">      </span><span class="o">================</span>
<span class="w">       </span>-<span class="w"> </span>Homepage:<span class="w"> </span>https://www.unidata.ucar.edu/software/netcdf/
</code></pre></div></p>
<p>This gives some information about the software as well as what we need to load it, in this case <code>GCC/8.3.0</code> and <code>OpenMPI/3.1.4</code>.  We can just use that and load netcdf -
<div class="highlight"><pre><span></span><code><span class="c1">#Load prerequisites - the "silo"</span>
module<span class="w"> </span>load<span class="w"> </span>GCC/8.3.0
module<span class="w"> </span>load<span class="w"> </span>OpenMPI/3.1.4

<span class="c1">#Load NetCDF</span>
module<span class="w"> </span>load<span class="w"> </span>netCDF
</code></pre></div></p>
<p>Alternatively you could load the toolchain containing <code>gcc/8.3.0</code> and <code>OpenMPI/3.1.4</code> - <code>foss/2019b</code>
<div class="highlight"><pre><span></span><code><span class="c1">#Load prerequisites - the "silo"</span>
module<span class="w"> </span>load<span class="w"> </span>foss/2019b

<span class="c1">#Load NetCDF</span>
module<span class="w"> </span>load<span class="w"> </span>netCDF
</code></pre></div></p>
<h2 id="toolchain-silo-table">Toolchain "silo" table<a class="headerlink" href="#toolchain-silo-table" title="Permanent link">¶</a></h2>
<p>Toolchains currently on Rāpoi as of May 2022.</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Toolchain</th>
<th style="text-align: center;">Compiler</th>
<th style="text-align: center;">MPI</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">foss/2018b</td>
<td style="text-align: center;">GCC/7.3.0</td>
<td style="text-align: center;">OpenMPI/3.1.1</td>
</tr>
<tr>
<td style="text-align: center;">foss/2019b</td>
<td style="text-align: center;">GCC/8.3.0</td>
<td style="text-align: center;">OpenMPI/3.1.4</td>
</tr>
<tr>
<td style="text-align: center;">foss/2020a</td>
<td style="text-align: center;">GCC/9.3.0</td>
<td style="text-align: center;">OpenMPI/4.0.3</td>
</tr>
<tr>
<td style="text-align: center;">foss/2020b</td>
<td style="text-align: center;">GCC/10.2.0</td>
<td style="text-align: center;">OpenMPI/4.0.5</td>
</tr>
<tr>
<td style="text-align: center;">foss/2021a</td>
<td style="text-align: center;">GCC/10.3.0</td>
<td style="text-align: center;">OpenMPI/4.1.1</td>
</tr>
</tbody>
</table>
<p>There are also toolchain versions with CUDA for use on the GPU nodes - they contain the same compiler and OpenMPI but also include a CUDA version</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Toolchain</th>
<th style="text-align: center;">Compiler</th>
<th style="text-align: center;">MPI</th>
<th style="text-align: center;">CUDA</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">fosscuda/2019b</td>
<td style="text-align: center;">GCC/8.3.0</td>
<td style="text-align: center;">OpenMPI/3.1.4</td>
<td style="text-align: center;">CUDA/10.1.243</td>
</tr>
<tr>
<td style="text-align: center;">fosscuda/2020b</td>
<td style="text-align: center;">GCC/10.2.0</td>
<td style="text-align: center;">OpenMPI/4.0.5</td>
<td style="text-align: center;">CUDA/11.1.1</td>
</tr>
</tbody>
</table>
<p>Lastly we have some intel compiler toolchains built.  This <em>might</em> work on the AMD nodes, but you'll have an easier time with the intel nodes.</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Toolchain</th>
<th style="text-align: center;">Compiler</th>
<th style="text-align: center;">Intel Compiler</th>
<th style="text-align: center;">MPI</th>
<th style="text-align: center;">MKL</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">intel/2021b</td>
<td style="text-align: center;">GCC/11.2.0</td>
<td style="text-align: center;">2021.4.0</td>
<td style="text-align: center;">impi/2021.4.0</td>
<td style="text-align: center;">imkl/2021.4.0</td>
</tr>
<tr>
<td style="text-align: center;">intel/2022.00</td>
<td style="text-align: center;">GCC/11.2.0</td>
<td style="text-align: center;">2022.0.1</td>
<td style="text-align: center;">impi/2021.5.0</td>
<td style="text-align: center;">imkl/2022.0.1</td>
</tr>
</tbody>
</table>
<p>You can also just experimentally module load the various toolchains and list to see what the module loads to see what it contains.</p>
<pre><code>
#load toolchain
module load foss/2020b

# List what it loads
module list

# Returns
Currently Loaded Modules:
  1) config           6) libfabric/1.11.0  11) libxml2/2.9.10     16) FFTW/3.3.8
  2) GCCcore/10.2.0   7) libevent/2.1.12   12) libpciaccess/0.16  17) OpenBLAS/0.3.12
  3) binutils/2.35    8) numactl/2.0.13    13) hwloc/2.2.0        18) ScaLAPACK/2.1.0
  4) <b>GCC/10.2.0</b>       9) XZ/5.2.5          14) PMIx/3.1.5         19) foss/2020b
  5) UCX/1.9.0       10) zlib/1.2.11       15) <b>OpenMPI/4.0.5</b>
</code></pre>
<h2 id="add-new-module-system-for-accounts-prior-to-march-2022">Add new module system for accounts prior to March 2022<a class="headerlink" href="#add-new-module-system-for-accounts-prior-to-march-2022" title="Permanent link">¶</a></h2>
<p>Users accounts setup prior to March 2022 will not automatically have the new module system loaded. You can automatically use this new module system (in parallel with the old one) by adding a line to your <code>.bashrc</code> file.  Users of zsh can make a similar change to their .zshrc file.</p>
<p>Login to Rāpoi and backup your <code>.bashrc</code> file, then edit it to add the needed line in.</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>~<span class="w">  </span><span class="c1"># change to your home directory</span>
cp<span class="w"> </span>.bashrc<span class="w"> </span>.bashrc_backup<span class="w"> </span><span class="c1">#create backup of your bashrc file</span>

nano<span class="w"> </span>.bashrc<span class="w">  </span><span class="c1">#open the nano editor to edit your file</span>

<span class="c1">#in nano find the line </span>
<span class="c1"># module use -a /home/software/tools/modulefiles</span>
<span class="c1"># it will be near the end of the file.  After that line, add the line:</span>
module<span class="w"> </span>use<span class="w"> </span>/home/software/tools/eb_modulefiles/all/Core

<span class="c1">#press control-x to exit nano.  It will ask if you want to save the modified buffer.  Type Y to save the change.  </span>
<span class="c1"># It'll ask for the filename, just press enter to accept the name</span>
<span class="c1"># .bashrc</span>
</code></pre></div>
<p>After you have made that change logout and log back in to have the new module system loaded.  You can test it's working by loading a toolchain.
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>load<span class="w"> </span>foss/2020a
</code></pre></div></p>
<p>If you run into problems, copy your .bashrc backup back to the original and try again with
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>.bashrc_backup<span class="w"> </span>.bashrc
</code></pre></div></p>
<p>Also feel free to ask for help on slack</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:1">
<p>Modules are the way programs are packaged up for you to use.  We can't just install them system wide as we have hundreds of programs installed in modules, often with many versions of the same thing, they would conflict with each other.  Modules let you load just what you need. See <a href="../environment/">Preparing your environment</a> <a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:2">
<p>The toolchain is comprised of a compiler and a version of MPI that was used to build the software.  For instance the toolchain foss/2021a uses GCC/10.3.0 and OpenMPI/4.1.1 <a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
</div>
</div><footer>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="Versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
</span>
</div>
<script src="../js/jquery-3.6.0.min.js"></script>
<script>var base_url = "..";</script>
<script src="../js/theme_extra.js"></script>
<script src="../js/theme.js"></script>
<script src="https://unpkg.com/mermaid@8.7.0/dist/mermaid.min.js"></script>
<script src="../search/main.js"></script>
<script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>
<script>mermaid.initialize({});</script></body>
</html>
